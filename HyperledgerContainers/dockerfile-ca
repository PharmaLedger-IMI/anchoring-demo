FROM hyperledger/fabric-ca:1.4.6

#"Env"
#"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
#"FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server"

#Volumes: NONE           

#Container start :
# - args:
#            - sh
#            - -c
#            - fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1-cert.pem
#              --ca.keyfile /etc/hyperledger/fabric-ca-server-config/priv_sk
#              -b admin:adminpw -d

#ENV variables for container start which must be configured
#FABRIC_CA_HOME : /etc/hyperledger/fabric-ca-server
#FABRIC_CA_SERVER_CA_NAME : ca-org1
#FABRIC_CA_SERVER_TLS_CERTFILE : /etc/hyperledger/fabric-ca-server-config/ca.org1-cert.pem
#FABRIC_CA_SERVER_TLS_ENABLED : "true"
#FABRIC_CA_SERVER_TLS_KEYFILE: /etc/hyperledger/fabric-ca-server-config/priv_sk

#Usage :
#  fabric-ca-server start [flags]
# Configuration flags can be configured on start or by using enviroment variables
#Enviroment variables are used by convension
# --address can be configured using FABRIC_CA_SERVER_ADDRESS
# --ca.certfile can be configured using FABRIC_CA_SERVER_CA_CERTFILE
#Global Flags:
#      --address string                            Listening address of fabric-ca-server (default "0.0.0.0")
#  -b, --boot string                               The user:pass for bootstrap admin which is required to build default config file
#      --ca.certfile string                        PEM-encoded CA certificate file (default "ca-cert.pem")
#      --ca.chainfile string                       PEM-encoded CA chain file (default "ca-chain.pem")
#      --ca.keyfile string                         PEM-encoded CA key file
#  -n, --ca.name string                            Certificate Authority name
#      --cacount int                               Number of non-default CA instances
#      --cafiles stringSlice                       A list of comma-separated CA configuration files
#      --cfg.affiliations.allowremove              Enables removal of affiliations dynamically
#      --cfg.identities.allowremove                Enables removal of identities dynamically
#      --cfg.identities.passwordattempts int       Number of incorrect password attempts allowed (default 10)
#      --cors.enabled                              Enable CORS for the fabric-ca-server
#      --cors.origins stringSlice                  Comma-separated list of Access-Control-Allow-Origin domains
#      --crl.expiry duration                       Expiration for the CRL generated by the gencrl request (default 24h0m0s)
#      --crlsizelimit int                          Size limit of an acceptable CRL in bytes (default 512000)
#      --csr.cn string                             The common name field of the certificate signing request to a parent fabric-ca-server
#      --csr.hosts stringSlice                     A list of comma-separated host names in a certificate signing request to a parent fabric-ca-server
#      --csr.keyrequest.algo string                Specify key algorithm
#      --csr.keyrequest.size int                   Specify key size
#      --csr.serialnumber string                   The serial number in a certificate signing request to a parent fabric-ca-server
#      --db.datasource string                      Data source which is database specific (default "fabric-ca-server.db")
#      --db.tls.certfiles stringSlice              A list of comma-separated PEM-encoded trusted certificate files (e.g. root1.pem,root2.pem)
#      --db.tls.client.certfile string             PEM-encoded certificate file when mutual authenticate is enabled
#      --db.tls.client.keyfile string              PEM-encoded key file when mutual authentication is enabled
#      --db.type string                            Type of database; one of: sqlite3, postgres, mysql (default "sqlite3")
#  -H, --home string                               Server's home directory (default "/usr/src/crypto-config/crypto-config/peerOrganizations/org1/ca")
#      --idemix.nonceexpiration string             Duration after which a nonce expires (default "15s")
#      --idemix.noncesweepinterval string          Interval at which expired nonces are deleted (default "15m")
#      --idemix.rhpoolsize int                     Specifies revocation handle pool size (default 100)
#      --intermediate.enrollment.label string      Label to use in HSM operations
#      --intermediate.enrollment.profile string    Name of the signing profile to use in issuing the certificate
#      --intermediate.enrollment.type string       The type of enrollment request: 'x509' or 'idemix' (default "x509")
#      --intermediate.parentserver.caname string   Name of the CA to connect to on fabric-ca-server
#  -u, --intermediate.parentserver.url string      URL of the parent fabric-ca-server (e.g. http://<username>:<password>@<address>:<port)
#      --intermediate.tls.certfiles stringSlice    A list of comma-separated PEM-encoded trusted certificate files (e.g. root1.pem,root2.pem)
#      --intermediate.tls.client.certfile string   PEM-encoded certificate file when mutual authenticate is enabled
#      --intermediate.tls.client.keyfile string    PEM-encoded key file when mutual authentication is enabled
#      --ldap.attribute.names stringSlice          The names of LDAP attributes to request on an LDAP search
#      --ldap.enabled                              Enable the LDAP client for authentication and attributes
#      --ldap.groupfilter string                   The LDAP group filter for a single affiliation group (default "(memberUid=%s)")
#      --ldap.tls.certfiles stringSlice            A list of comma-separated PEM-encoded trusted certificate files (e.g. root1.pem,root2.pem)
#      --ldap.tls.client.certfile string           PEM-encoded certificate file when mutual authenticate is enabled
#      --ldap.tls.client.keyfile string            PEM-encoded key file when mutual authentication is enabled
#      --ldap.url string                           LDAP client URL of form ldap://adminDN:adminPassword@host[:port]/base
#      --ldap.userfilter string                    The LDAP user filter to use when searching for users (default "(uid=%s)")
#      --loglevel string                           Set logging level (info, warning, debug, error, fatal, critical)
#  -p, --port int                                  Listening port of fabric-ca-server (default 7054)
#      --registry.maxenrollments int               Maximum number of enrollments; valid if LDAP not enabled (default -1)
#      --tls.certfile string                       PEM-encoded TLS certificate file for server's listening port (default "tls-cert.pem")
#      --tls.clientauth.certfiles stringSlice      A list of comma-separated PEM-encoded trusted certificate files (e.g. root1.pem,root2.pem)
#      --tls.clientauth.type string                Policy the server will follow for TLS Client Authentication. (default "noclientcert")
#      --tls.enabled                               Enable TLS on the listening port
#      --tls.keyfile string                        PEM-encoded TLS key for server's listening port



CMD ["/bin/sh", "-c", "fabric-ca-server start -b admin:adminpw"]